# CurveWithBPM

AviUtl プラグイン&スクリプト、[Curve Editor](https://github.com/mimaraka/aviutl-plugin-curve_editor) を利用して、指定した BPM のリズムに合わせた滑らかな反復動作を簡単に記述できるようにする AviUtl スクリプトです。

> [!CAUTION]
> [Curve Editor](https://github.com/mimaraka/aviutl-plugin-curve_editor) は同梱されていないので、ご自身で導入する必要があります。

## 導入方法

> [!NOTE]
> 一般的な AviUtl スクリプトと同様ですが、事前に [Curve Editor](https://github.com/mimaraka/aviutl-plugin-curve_editor) の導入が必須です。

1. [Curve Editor](https://github.com/mimaraka/aviutl-plugin-curve_editor) を導入する。（導入方法は先方の記載をご確認ください。）
2. Releases から ZIP ファイルをダウンロードする。
3. ZIP ファイルを展開して、AviUtl の `script` フォルダー、または `script` フォルダー直下の子フォルダーに、展開した中身を全てコピーする。

> [!TIP]
> `LICENSE.TXT` `README.md` は必ずしもコピーしなくともよいです。

## 使い方

### アニメーション効果 - 基本操作

移動・回転・拡大・縮小が行えます。使える Curve は 1 つです。

1. CurveEditor のウィンドウで、`ベジェ(複数)` を選択し、任意の ID で Curve を作成します。
2. 動かしたい対象に、アニメーション効果 `基本操作@CurveWithBPM` を追加します。
3. `BPM` パラメーターを指定します。
4. ID パラメーターに (1.) で作成した Curve の ID を指定します。
5. 値入力ダイアログを開き、各要素の変化量を指定します。

### アニメーション効果 - 基本往復

移動・回転・拡大・縮小が行えます。使える Curve は 2 つです。

1. CurveEditor のウィンドウで、「ベジェ(複数)」を選択し、任意の ID で Curve を作成します。
2. 動かしたい対象に、アニメーション効果 `基本往復@CurveWithBPM` を追加します。
3. `BPM` パラメーターを指定します。
4. 行きID 及び 帰りID パラメーターに (1.) で作成した Curve の ID を指定します。同一の ID を指定することも可能です。
5. 値入力ダイアログを開き、各要素の変化量を指定します。

### カスタムオブジェクト - トラックバー往復

トラックバーでの動作を宣言するためのカスタムオブジェクトです。トラックバーと組み合わせて使用します。

1. CurveEditor のウィンドウで、「ベジェ(複数)」を選択し、任意の ID で Curve を作成します。
2. カスタムオブジェクト `トラックバー往復@CurveWithBPM` をトラックバーで使用するオブジェクトより上（番号の若い）のレイヤーに追加します。
3. `BPM` パラメーターを指定します。
4. 行きID 及び 帰りID パラメーターに (1.) で作成した Curve の ID を指定します。同一の ID を指定することも可能です。
5. 値入力ダイアログを開き、このカスタムオブジェクトを識別するためのユニークな（重複しない） ID [^unique-id]を指定します。

### トラックバー - 往復区間

指定した区間内の数値をリズムに合わせて往復させます。カスタムオブジェクト `トラックバー往復@CurveWithBPM` と組み合わせて使用します。

1. カスタムオブジェクト `トラックバー往復@CurveWithBPM` を作成し、設定する。
2. 指定したいパラメーター項目をクリックし、`往復区間@CurveWithBPM` を指定する。
3. 再度パラメーター項目をクリックし、設定\[0\] を開き、移動フレーム指定の欄に、カスタムオブジェクト - トラックバー往復 で指定した、カスタムオブジェクトを識別するための ID を入力します。
4. 移動させたい範囲を指定します。

> [!TIP]
> 中間点を使った場合、各フレームごとに直前の中間点（ないし先頭）の値から、直後の中間点（ないし末尾）の値までの間で動きます。

### トラックバー - 往復差分

指定した区間内の数値をリズムに合わせて往復させます。カスタムオブジェクト `トラックバー往復@CurveWithBPM` と組み合わせて使用します。

1. カスタムオブジェクト `トラックバー往復@CurveWithBPM` を作成し、設定する。
2. 指定したいパラメーター項目をクリックし、`往復区間@CurveWithBPM` を指定する。
3. 再度パラメーター項目をクリックし、設定\[0\] を開き、移動フレーム指定の欄に、カスタムオブジェクト - トラックバー往復 で指定した、カスタムオブジェクトを識別するための ID を入力します。
4. 移動させたい量を指定します。先頭が初期値、以降の中間点及び末尾には差分を指定します。

> [!TIP]
> 中間点を使った場合、各フレームごとに先頭の値（初期値）から、直後の中間点（ないし末尾）の値＋初期値 までの間で動きます。

## オプション説明

### BPM

1 分間に何回動くかを指定します。

### ずらし

指定フレーム分補正を加えます。

### ID / 行きID / 帰りID

Curve Editor のベジェ(複数)の ID を指定します。そのほか、以下の特別な値が指定可能です。

|ID|説明|数式表現|
|---:|:---|:---|
|`0`|直線移動|$t$|
|`-1`|移動無し|$1$|
|`-2`|移動無し|$0$|

詳しくはグラフ表示機能を使ってご確認ください。

### 反転

帰りのカーブを左右反転します。

詳しくはグラフ表示機能を使ってご確認ください。

### 配分

行きと帰りの時間配分を `0.0` から `1.0` までの値で設定します。

詳しくはグラフ表示機能を使ってご確認ください。

### X座標 / Y座標 / Z座標 / X回転 / Y回転 / Z回転

変化量を指定します。

### 拡大率 / X拡大 / Y拡大

変化後の値を指定します。

### 同期

フレームレートと BPM がそろわない場合に補正するかを選択します。

|値|効果|
|:---|:---|
|`false`|補正しない|
|`true`|補正する|
|それ以外の値|未定義|

### 表示

編集時にグラフを表示するかを選択します。

|値|効果|
|:---|:---|
|`false`|表示しない|
|`true`|表示する|
|それ以外の値|未定義|

> [!NOTE]
> グラフは該当オブジェクトを選択しているときのみ表示されます。

> [!TIP]
> エンコード時には表示されません。

### ID（カスタムオブジェクト）

該当カスタムオブジェクトを識別するための ID [^unique-id]を設定します。

### 設定（トラックバー）

カスタムオブジェクトを識別するための ID を指定します。

## 注意事項

本スクリプトは [MIT No Attribution License
](LICENSE.txt)のもとに公開されています。本スクリプトの使用によって生じたいかなる損害に対しても何ら責任も負わないものとします。

[^unique-id]: 自然数以外は動作未検証。
